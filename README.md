# pragma web — a tiny static site generator

pragma web builds a simple blog/site from Markdown sources. It reads a site config, parses Markdown to HTML, creates index pages, a chronological "scroll," per-tag listings ("tag index"), individual post pages, and a simple RSS feed (feed.xml) of the previous 20 posts. It uses a simple templating system to allow flexible output and modularity. The goals are simplicity and speed.

- **Language:** C 
- **Libraries/Dependencies**: C standard library
- **Status:** Active development, working beta
- **License:** MIT

## What it does (site generation at a glance)
- Loads site config (`pragma_config.yml`) and site sources from a directory; sources are plaintext HTML and/or Markdown and use epoch date as filename e.g. `1738193953.3103302.txt`
- Parses Markdown → HTML if source file does not specify `parse:false` (render headings, paragraphs, inline emphasis, code, images, basic lists)
- Builds:
  - `index.html`, `index1.html`, … (paged, linked indices)
  - `s/index.html` (chronological scroll of all content, newest to oldest)
  - `t/index.html` + `/t/{tag}.html` (folksonomy tag index: all tags and pages that use them)
  - `/p/{epoch}.html` (one page per post)
- Uses a basic templating system for output, with tokens such as `{TITLE}`, `{PAGETITLE}`, `{DATE}`, `{TAGS}`, `{PAGE_URL}`, `{FORWARD}`, `{BACK}`, `{MAIN_IMAGE}`, etc

---

## Quick start
**Building**
The software depends on standard library headers and should build cleanly without special configuration:

` make`
or:
` gcc -O2 -o pragma src/*.c`

After building the executable, the first step is to create a new site, which you can do by passing the -c argument to the executable and specifying the intended path.

`./pragma -c /path/to/site`

You'll need to edit /path/to/site/pragma_config.yml. Optionally, you can customize the header/footer templates, output templates, JavaScript file (blank by default), and CSS. 

**Generating an Existing Site**

`./pragma -s /path/to/site [-o /path/to/output]`

If `-o` is omitted, output defaults to the data directory, and `index.html` will live in the parent directory of `dat`. Generally, that's fine, if not a totally clean separation of source data and output. You can just deploy the site with `rsync` (or `cp`, or anything) and omit `dat`, of course.  `-h` displays basic usage/help.

## Configuration 
- pragma_config.yml (required, generated by `pragma -c`) lives in the source directory and specifies site metadata, index size, header/footer paths, base URL, icon settings.
- Header/footer and output templates in the site path supply basic layout. pragma generates navigation links and folksonomy catalogues. The output templates are:

`templates/index_item.html` How pragma arranges output for post entries/excerpts on indices
`templates/navigation.html` Navigation widget (forward/back)
`tempaltes/post_card.html` same as index item by default, can be changed for use in other contexts
`templates/single_page.html` template for a single HTML page of the site


## Notes on implementation
- Wide-char parsing is enabled with `setlocale(LC_CTYPE, "en_US.UTF-8");` at the beginning of `main()`, and the argument to `setlocale()` should be changed for other locales (or better yet, I should move it to the configuration file).
- Markdown is handled in pragma_markdown.c; page assembly in pragma_page_builder.c
- Index/scroll/tag/rss builders in corresponding *_builder.c files
- Function headers document basic arguments and usage as well as memory ownership (callers free where noted)

### Known limitations 
- Time handling uses localtime(), which technically is not thread-safe but is fine in this case
- Markdown: coverage is basic (no tables, fenced blocks, etc.)
- Need to centralize error and status logging
- Separation of concerns between rednering and assembly is way better than it was in the hacked-together prototype, but still could be refined